!function(){"use strict";angular.module("app.gde.adapter",[])}(),function(){"use strict";function gdeAdapterDirective($window,$timeout,GdeAdapterService){return{restrict:"E",scope:{},template:'<iframe width="100%" height="100%" id="iframe" src="about:blank" scrolling="no" style="border:0;position:absolute;"></iframe>',link:function($scope,$element,$attrs){function openActionCallback(onDocumentOpenedPostMessageCallback,args){$timeout(function(){$window.addEventListener("message",onDocumentOpenedPostMessageCallback,!1),$scope.$apply(function(){$("#iframe").replaceWith($("#iframe").clone().attr("src",args))})})}function documentLoadedCallback(onDocumentOpenedPostMessageCallback){$window.removeEventListener("message",onDocumentOpenedPostMessageCallback,!1)}function saveCompletedActionCallback(onSaveCompletedPostMessageCallback){$window.removeEventListener("message",onSaveCompletedPostMessageCallback,!1)}function saveActionCallback(onSaveCompletedPostMessageCallback,targetOrigin){$window.addEventListener("message",onSaveCompletedPostMessageCallback,!1),$("#iframe")[0].contentWindow.postMessage("SAVE",targetOrigin)}function sendValuesActionCallback(payload,targetOrigin){$("#iframe")[0].contentWindow.postMessage(payload,targetOrigin)}function cancelActionCallback(onCancelCompletedPostMessageCallback,targetOrigin){$("#iframe")[0].contentWindow.postMessage("CANCEL",targetOrigin)}function cancelCompletedActionCallback(onCancelCompletedPostMessageCallback,targetOrigin){$window.removeEventListener("message",onCancelCompletedPostMessageCallback,!1)}GdeAdapterService.registerCallbacks({openActionCallback:openActionCallback,documentLoadedCallback:documentLoadedCallback,saveActionCallback:saveActionCallback,saveCompletedActionCallback:saveCompletedActionCallback,sendValuesActionCallback:sendValuesActionCallback,cancelActionCallback:cancelActionCallback,cancelCompletedActionCallback:cancelCompletedActionCallback}),$scope.$on("$destroy",function(){GdeAdapterService.unregisterCallbacks()})}}}angular.module("app.gde.adapter").directive("gdeAdapter",gdeAdapterDirective),gdeAdapterDirective.$inject=["$window","$timeout","GdeAdapterService"]}(),function(){"use strict";function GdeAdapterServiceProvider(){var provider=this;provider.setGdeHost=function(value){provider.gdeHost=value},this.$get=["$sce","$q","$timeout","$window","$rootScope","GdeConfigService",function($sce,$q,$timeout,$window,$rootScope,GdeConfigServiceProvider){function trustedSource(src){return $sce.trustAsResourceUrl(src)}function buildPayload(success,errorCode,errorMsg,docId,internalCode,caseNumber,data){return{success:success,errorCode:errorCode,errorMsg:errorMsg,docId:docId,internalCode:internalCode,caseNumber:caseNumber,data:data}}function buildUrlParams(isForm){function stringNotEmpty(pVar){return angular.isDefined(pVar)&&null!==pVar&&""!==pVar}function addSepIfNecessary(checkString){return""!==checkString?checkString+"&":checkString}var resultString="?clex=y&tool=n";return isForm&&stringNotEmpty($rootScope.noDossierE[0].id)&&(resultString=addSepIfNecessary(resultString),resultString=resultString+"noDo="+$rootScope.noDossierE[0].id),resultString}function getCallbacks(){return void 0!==callbacks?$q.when(callbacks):callbacksDeferred.promise}var callbacks,service={},callbacksDeferred=$q.defer();return service.registerCallbacks=function(value){callbacks=value,callbacksDeferred.resolve(callbacks)},service.unregisterCallbacks=function(){callbacks=void 0},service.open=function(params){function onDocumentOpenedPostMessageCallback(event){event.origin==targetOrigin&&void 0!==typeof event.data&&"unchanged"!=event.data&&$timeout(function(){console.log("Received data: "+JSON.stringify(event.data)),finalizeActionCallback(event.data)})}function finalizeActionCallback(data){void 0!==callbacks.documentLoadedCallback?(callbacks.documentLoadedCallback(onDocumentOpenedPostMessageCallback),payload=buildPayload(!0,void 0,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.resolve(payload)):(payload=buildPayload(!1,"Unregistred callback: documentLoadedCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))}var deferred=$q.defer(),payload={};if(void 0===params)return payload=buildPayload(!1,"Parameters needed for: open()",void 0,void 0,void 0,void 0,void 0),void deferred.reject(payload);var targetOrigin=GdeConfigServiceProvider.getTargetOrigin(),iframeUrl=trustedSource(targetOrigin+"#/"+params.lang+"/gde/"+params.docId+buildUrlParams(!1));return getCallbacks().then(function(callbacks){void 0!==callbacks.openActionCallback?callbacks.openActionCallback(onDocumentOpenedPostMessageCallback,iframeUrl):(payload=buildPayload(!1,"Unregistred callback: openActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))},function(reason){payload=buildPayload(!1,reason,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload)}),deferred.promise},service.create=function(params){function onDocumentOpenedPostMessageCallback(event){event.origin==targetOrigin&&void 0!==typeof event.data&&"unchanged"!=event.data&&$timeout(function(){console.log("Received data: "+JSON.stringify(event.data)),finalizeActionCallback()})}function finalizeActionCallback(){void 0!==callbacks.sendValuesActionCallback?(callbacks.sendValuesActionCallback(params.data,targetOrigin),void 0!==callbacks.documentLoadedCallback?(callbacks.documentLoadedCallback(onDocumentOpenedPostMessageCallback),payload=buildPayload(!0,void 0,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.resolve(payload)):(payload=buildPayload(!1,"Unregistred callback: documentLoadedCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))):(payload=buildPayload(!1,"Unregistred callback: sendValuesActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))}var deferred=$q.defer(),payload={};if(void 0===params)return payload=buildPayload(!1,"Parameters needed for: create()",void 0,void 0,void 0,void 0,void 0),void deferred.reject(payload);var targetOrigin=GdeConfigServiceProvider.getTargetOrigin(),iframeUrl=trustedSource(targetOrigin+"#/"+params.lang+"/gde/"+params.noDossier+"/nouveau_document/"+params.codeInterneDuFormulaire+buildUrlParams(!1));return getCallbacks().then(function(callbacks){void 0!==callbacks.openActionCallback?callbacks.openActionCallback(onDocumentOpenedPostMessageCallback,iframeUrl):(payload=buildPayload(!1,"Unregistred callback: openActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))},function(reason){payload=buildPayload(!1,reason,void 0,params.docId,void 0,void 0,void 0),deferred.reject(payload)}),deferred.promise},service.cancel=function(params){function onCancelCompletedPostMessageCallback(event){event.origin==targetOrigin&&void 0!==typeof event.data&&"unchanged"!=event.data&&$timeout(function(){console.log("Received data: "+JSON.stringify(event.data)),finalizeActionCallback(event.data)})}function finalizeActionCallback(data){void 0!==callbacks.cancelCompletedActionCallback?(callbacks.cancelCompletedActionCallback(onCancelCompletedPostMessageCallback),payload=buildPayload(!0,void 0,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.resolve(payload)):(payload=buildPayload(!1,"Unregistred callback: cancelCompletedActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))}var deferred=$q.defer(),payload={},targetOrigin=GdeConfigServiceProvider.getTargetOrigin();return void 0!==callbacks.cancelActionCallback?(callbacks.cancelActionCallback(onCancelCompletedPostMessageCallback,targetOrigin),payload=buildPayload(!0,void 0,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.resolve(payload)):(payload=buildPayload(!1,"Unregistred callback: cancelActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload)),deferred.promise},service.save=function(params){function onSaveCompletedPostMessageCallback(event){event.origin==targetOrigin&&void 0!==typeof event.data&&"unchanged"!=event.data&&$timeout(function(){console.log("Received data: "+JSON.stringify(event.data)),finalizeActionCallback(event.data)})}function finalizeActionCallback(data){void 0!==callbacks.saveCompletedActionCallback?(callbacks.saveCompletedActionCallback(onSaveCompletedPostMessageCallback,targetOrigin),data.webgde.documentSaved===!0?(payload=buildPayload(!0,void 0,void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,data),deferred.resolve(payload)):(payload=buildPayload(!1,data.webgde.reason,data.webgde.errorMessage,params.docId,params.codeInterneDuFormulaire,params.noDossier,data.webgde.documentData),deferred.reject(payload))):(payload=buildPayload(!1,"Unregistred callback: saveCompletedActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload))}var deferred=$q.defer(),payload={},targetOrigin=GdeConfigServiceProvider.getTargetOrigin();return void 0!==callbacks.saveActionCallback?callbacks.saveActionCallback(onSaveCompletedPostMessageCallback,targetOrigin):(payload=buildPayload(!1,"Unregistred callback: saveActionCallback",void 0,params.docId,params.codeInterneDuFormulaire,params.noDossier,void 0),deferred.reject(payload)),deferred.promise},service.print=function(params){},service.history=function(params){},service.close=function(params){},service}]}angular.module("app.gde.adapter").provider("GdeAdapterService",GdeAdapterServiceProvider)}(),function(){"use strict";function GdeConfigServiceProvider(){var provider=this,trustedUrls={};return{setConfig:function(path){provider.configPath=path},setTrustedUrls:function(data){trustedUrls={targetOrigin:data.targetOrigin,currentWindow:data.currentWindow}},$get:function(){return{getTargetOrigin:function(){return trustedUrls.targetOrigin},getCurrentWindow:function(){return trustedUrls.currentWindow}}}}}angular.module("app.gde.adapter").provider("GdeConfigService",GdeConfigServiceProvider)}();